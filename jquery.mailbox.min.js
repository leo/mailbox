/*
	Mailbox 4 - A contact-form for the new web.
	Made by Leonard Lamprecht - //github.com/leo/mailbox
*/

(function(e){e.fn.mailbox=function(t){function o(t){if(e(r).hasClass(t)){return true}return false}function u(t){e.each(t,function(t,n){if(n!=null){e(r).find('[name="'+t+'"]').val(n);e(r).data(t,n)}});e(r).attr("class","open")}function a(t,i){e(r).attr("class","closed");setTimeout(function(){e.each(attributes,function(t,n){e(r).removeData(t)});e(r).find(".success").fadeOut(200,function(){e.each(n.labels,function(t,i){e(r).find('label[for="'+t+'"]').html(n.labels[i]);e(r).find('input[type="text"], textarea').removeAttr("disabled").val("");e(r).find(".warning").removeClass("warning")});e(r).find("form").fadeIn(200,function(){if(t=="reopen"&&e.isFunction(i)){i()}})})},s)}function f(){var t='<aside id="mailbox" class="closed"><span class="close">x</span>';t+='<form method="post" action="'+n.script+'">';e.each(n.labels,function(e,n){t+='<label for="'+e+'">'+n+"</label>";if(e!=="body"){t+='<input name="'+e+'" id="'+e+'" type="text" autocomplete="off" />'}else{t+='<textarea name="body" id="'+e+'" rows="6" ></textarea>'}});t+='<button class="send" name="submit" type="submit">'+n.send+"</button>";t+='</form><div class="success"><span>&#x2713;</span><p>'+n.success+"</p></div></aside>";return t}var n={send:"Send message",success:"Your message has been sent successfully!",labels:{name:"name",email:"e-mail",subject:"subject",body:"message"},script:"mailbox.php",complete:null};if(t){e.extend(n,t)}var r="#mailbox";var i=e(r).css("transition-duration");var s=i.substr(0,i.indexOf("s"))*1e3;attributes={to:null,subject:null,body:null,cc:null,bcc:null};e("body").append(f());e(r).find(".close").click(a);e(this).find('a[href^="mailto:"]').click(function(t){var n=e(this).attr("href");e.each(attributes,function(e,t){attributes[e]=null});if(n.indexOf("?")>-1){var i=n.split("?")[1];if(i.indexOf("&")>-1){var s=i.split("&");e.each(s,function(e,t){var n=t.split("=");attributes[n[0]]=n[1]})}else{var f=i.split("=");attributes[f[0]]=f[1]}attributes["to"]=n.split("mailto:")[1].split("?")[0]}else{attributes["to"]=n.split("mailto:")[1]}var l="mailbox-on";if(o("closed")){u(attributes)}else if(o("open")){if(!e(this).hasClass(l)){e.each(attributes,function(t,n){if(n!==null&&n!==e(r).data(t)){a("reopen",function(){u(attributes)});return false}})}else{a()}}e("."+l).removeClass(l);e(this).addClass(l);t.preventDefault()});var l=e(r).find("form");e(l).submit(function(){function t(e){var t=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return t.test(e)}e.each(n.labels,function(t){attributes[t]=e(l).find('[name="'+t+'"]').val()});e.each(attributes,function(n,r){function s(){e(i).removeClass("warning")}function o(){e(i).addClass("warning")}var i=e(l).find('[for="'+n+'"]');if(!r){o()}else{if(n=="email"){if(t(r)){s()}else{o()}}else{s()}}});if(e(l).find(".warning").length==0){attributes["adress"]=e(l).find('[name="email"]').val();e.ajax({type:"POST",url:e(l).attr("action"),data:attributes,success:function(t){if(t==1){e(l).fadeOut(200,function(){e(r).find(".success").fadeIn(200,function(){if(e.isFunction(n.complete)){n.complete()}})})}}})}return false})}})(jQuery)
