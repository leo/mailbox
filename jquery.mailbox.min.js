/*
	Mailbox 4 - A contact-form for the new web.
	Made by Leonard Lamprecht - //github.com/leo/mailbox
*/

(function(e){e.fn.mailbox=function(t){function i(t){if(e(r).hasClass(t)){return true}return false}function s(t){e.each(t,function(t,n){if(n!=null){e(r).find('[name="'+t+'"]').val(n);e(r).data(t,n)}});e(r).attr("class","open")}function o(t,i){e(r).attr("class","closed");var s=e(r).css("transition-duration");setTimeout(function(){e.each(attributes,function(t,n){e(r).removeData(t)});e(r).find(".success").fadeOut(200,function(){e.each(n.labels,function(t,i){e(r).find('label[for="'+t+'"]').html(n.labels[i]);e(r).find('input[type="text"], textarea').removeAttr("disabled").val("");e(r).find(".warning").removeClass("warning")});e(r).find("form").fadeIn(200,function(){if(t=="reopen"&&e.isFunction(i)){i()}})})},s.replace("s","")*1e3)}function u(){var t='<aside id="mailbox" class="closed"><span class="close">x</span>';t+='<form method="post" action="'+n.script+'">';e.each(n.labels,function(e,n){t+='<label for="'+e+'">'+n+"</label>";if(e!=="body"){t+='<input name="'+e+'" id="'+e+'" type="text" autocomplete="off" />'}else{t+='<textarea name="body" id="'+e+'" rows="6" ></textarea>'}});t+='<button class="send" name="submit" type="submit">'+n.send+"</button>";t+='</form><div class="success"><span>&#x2713;</span><p>'+n.success+"</p></div></aside>";return t}var n={send:"Send message",success:"Your message has been sent successfully!",labels:{name:"name",email:"e-mail",subject:"subject",body:"message"},script:"mailbox.php",complete:null};if(t){e.extend(n,t)}var r="#mailbox";attributes={to:null,subject:null,body:null,cc:null,bcc:null};e("body").append(u());e(r).find(".close").click(o);e(this).find('a[href^="mailto:"]').click(function(t){var n=e(this).attr("href");e.each(attributes,function(e,t){attributes[e]=null});if(n.indexOf("?")>-1){var u=n.split("?")[1];if(u.indexOf("&")>-1){var a=u.split("&");e.each(a,function(e,t){var n=t.split("=");attributes[n[0]]=n[1]})}else{var f=u.split("=");attributes[f[0]]=f[1]}attributes["to"]=n.split("mailto:")[1].split("?")[0]}else{attributes["to"]=n.split("mailto:")[1]}var l="mailbox-on";if(i("closed")){s(attributes)}else if(i("open")){if(!e(this).hasClass(l)){e.each(attributes,function(t,n){if(n!==null&&n!==e(r).data(t)){o("reopen",function(){s(attributes)});return false}})}else{o()}}e("."+l).removeClass(l);e(this).addClass(l);t.preventDefault()});var a=e(r).find("form");e(a).submit(function(){function t(e){var t=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return t.test(e)}e.each(n.labels,function(t){attributes[t]=e(a).find('[name="'+t+'"]').val()});e.each(attributes,function(n,r){function s(){e(i).removeClass("warning")}function o(){e(i).addClass("warning")}var i=e(a).find('[for="'+n+'"]');if(!r){o()}else{if(n=="email"){if(t(r)){s()}else{o()}}else{s()}}});if(e(a).find(".warning").length==0){attributes["adress"]=e(a).find('[name="email"]').val();e.ajax({type:"POST",url:e(a).attr("action"),data:attributes,success:function(t){if(t==1){e(a).fadeOut(200,function(){e(r).find(".success").fadeIn(200,function(){if(e.isFunction(n.complete)){n.complete()}})})}}})}return false})}})(jQuery)
