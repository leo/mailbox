/*!
	Mailbox v0.0.1
	Copyright 2014 Leonard Lamprecht - https://github.com/lmprht/mailbox
	license: http://opensource.org/licenses/mit-license.php
*/

(function(e){e.fn.mailbox=function(t){function i(t,n,i,s,o,u){if(typeof o!=="undefined"&&o!==false){e(r+' input[name="subject"]').val(o)}if(typeof u!=="undefined"&&u!==false){e(r+" textarea").val(u)}if(typeof i!=="undefined"&&i!==false){var i=false}if(typeof s!=="undefined"&&s!==false){var s=false}e(r).attr("class","on_ma_way");e(r+' input[name="sess_id"]').attr("value",t);e(r).animate({right:"0"},500,function(){e(r).attr("class","open")})}function s(){e(r).attr("class","on_ma_way");var t=e(r).css("width");var i="-"+t;e(r).animate({right:i},500);e(r+" .success").fadeOut(200);setTimeout(function(){e(r+" form").fadeIn(200)},250);setTimeout(function(){e(r+' label[for="name"]').html(n.label.name);e(r+' label[for="email"]').html(n.label.email);e(r+' label[for="subject"]').html(n.label.subject);e(r+' label[for="message"]').html(n.label.message);e(r+' input[type="text"], '+r+" textarea").removeAttr("disabled");e(r+" .send").html(n.send_text);e(r+' input[name="name"]').val("");e(r+' input[name="email"]').val("");e(r+' input[name="subject"]').val("");e(r+" textarea").val("");e(r).attr("class","closed");e(r+' input[type="hidden"]').removeAttr("value");e(r+" label.warning").removeClass("warning")},500)}var n={send_text:"Send message",success_text:"Your message has been sent successfully!",label:{name:"name",email:"e-mail",subject:"subject",message:"message"},send_url:"mb_send.php",complete:null};if(t){e.extend(n,t)}if(n.send_url!="mb_send.php"){e.ajax({url:n.send_url,type:"HEAD"})}var r="#mailbox";e(this).each(function(){var t="";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var r=0;r<10;r++)t+=n.charAt(Math.floor(Math.random()*n.length));e(this).attr("data-mail-id",t);var i=e(this).attr("href");if(i.indexOf(",")>-1){if(i.indexOf(", ")>-1){}else{console.warn('The e-mail addresses in the mailto-links should be seperatet with a comma + space (e.g. "hi@test.net, ho@test.org").')}}if(i.indexOf("@")>6){if(i.indexOf("?")>6){var s=i.substr(0,i.indexOf("?"));var o=s.split("mailto:")[1]}else{var o=i.split("mailto:")[1]}if(i.indexOf("?")>6){var u=i.split("?")[1];var a=u.split("&")[0];if(typeof a==="undefined"){var a="-"}var f=u.split("&")[1];if(typeof f==="undefined"){var f="-"}var l=u.split("&")[2];if(typeof l==="undefined"){var l="-"}var c=u.split("&")[3];if(typeof c==="undefined"){var c="-"}if(a.indexOf("body")==0){var h=a.split("body=")[1]}if(a.indexOf("subject")==0){var p=a.split("subject=")[1]}if(a.indexOf("cc")==0){var d=a.split("cc=")[1]}if(a.indexOf("bcc")==0){var v=a.split("bcc=")[1]}if(f.indexOf("body")==0){var h=f.split("body=")[1]}if(f.indexOf("subject")==0){var p=f.split("subject=")[1]}if(f.indexOf("cc")==0){var d=f.split("cc=")[1]}if(f.indexOf("bcc")==0){var v=f.split("bcc=")[1]}if(l.indexOf("body")==0){var h=l.split("body=")[1]}if(l.indexOf("subject")==0){var p=l.split("subject=")[1]}if(l.indexOf("cc")==0){var d=l.split("cc=")[1]}if(l.indexOf("bcc")==0){var v=l.split("bcc=")[1]}if(c.indexOf("body")==0){var h=c.split("body=")[1]}if(c.indexOf("subject")==0){var p=c.split("subject=")[1]}if(c.indexOf("cc")==0){var d=c.split("cc=")[1]}if(c.indexOf("bcc")==0){var v=c.split("bcc=")[1]}}e(this).attr("data-msg-receiver",o);if(typeof p==="undefined"){}else{e(this).attr("data-msg-subject",p)}if(typeof h==="undefined"){}else{e(this).attr("data-msg-body",h)}if(typeof d==="undefined"){}else{e(this).attr("data-msg-cc",d)}if(typeof v==="undefined"){}else{e(this).attr("data-msg-bcc",v)}e(this).attr("href","javascript: void(0)")}else{console.error("The href-attribute of one element does not contain a valid mailto-link.")}});e(this).click(function(){var t=e(this).attr("data-mail-id");var n=e(this).attr("data-msg-receiver");var o=e(this).attr("data-msg-subject");var u=e(this).attr("data-msg-body");var a=e(this).attr("data-msg-cc");var f=e(this).attr("data-msg-bcc");if(e(r).hasClass("closed")){i(t,n,a,f,o,u)}if(e(r).hasClass("open")){s();var l=e(r+' input[name="sess_id"]').val();if(t!=l){setTimeout(function(){i(t,n,a,f,o,u)},1e3)}}});e(document).ready(function(){e(r+" .close").click(function(){s()})});var o='<div id="mailbox" class="closed">'+'<span class="close">x</span>'+'<form method="post">'+'<input type="hidden" name="sess_id">'+'<label for="name">'+n.label.name+"</label>"+'<input name="name" id="name" type="text" autocomplete="off" >'+'<label for="email">'+n.label.email+"</label>"+'<input name="email" id="email" type="text" autocomplete="off">'+'<label for="subject">'+n.label.subject+"</label>"+'<input name="subject" id="subject" type="text" autocomplete="off">'+'<label for="message">'+n.label.message+"</label>"+'<textarea name="message" id="message" rows="6" ></textarea>'+'<button class="send" name="submit" type="submit">'+n.send_text+"</button>"+"</form>"+'<div class="success">'+"<span>&#x2713;</span>"+"<p>"+n.success_text+"</p>"+"</div></div>";e("body").append(o);e("#mailbox form").submit(function(){function u(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}var t=e(r+' input[name="name"]').val();var i=e(r+' input[name="email"]').val();var s=e(r+' input[name="subject"]').val();var o=e(r+" textarea").val();if(!t||!i||!u(i)||!s||!o){if(!t){e(r+' label[for="name"]').addClass("warning");e(r+' label[for="name"]').html(n.label.name+" [!]")}else{e(r+' label[for="name"]').removeClass("warning");e(r+' label[for="name"]').html(n.label.name)}if(!i||!u(i)){e(r+' label[for="email"]').addClass("warning");e(r+' label[for="email"]').html(n.label.email+" [!]")}else{e(r+' label[for="email"]').removeClass("warning");e(r+' label[for="email"]').html(n.label.email)}if(!s){e(r+' label[for="subject"]').addClass("warning");e(r+' label[for="subject"]').html(n.label.subject+" [!]")}else{e(r+' label[for="subject"]').removeClass("warning");e(r+' label[for="subject"]').html(n.label.subject)}if(!o){e(r+' label[for="message"]').addClass("warning");e(r+' label[for="message"]').html(n.label.message+" [!]")}else{e(r+' label[for="message"]').removeClass("warning");e(r+' label[for="message"]').html(n.label.message)}}else{var a=e(r+' input[name="sess_id"]').val();var f=e('a[data-mail-id="'+a+'"]').attr("data-msg-receiver");var l=e('a[data-mail-id="'+a+'"]').attr("data-msg-cc");var c=e('a[data-mail-id="'+a+'"]').attr("data-msg-bcc");if(typeof l==="undefined"||l==false){var l=false}if(typeof c==="undefined"||c==false){var c=false}e.ajax({type:"POST",url:n.send_url,data:{to:f,cc:l,bcc:c,name:e(r+' input[name="name"]').val(),address:e(r+' input[name="email"]').val(),subject:e(r+' input[name="subject"]').val(),message:e(r+" textarea").val()},success:function(t){if(t=="success"){e(r+' input[type="hidden"]').removeAttr("value");e(r+" form").fadeOut(200);setTimeout(function(){e(r+" .success").fadeIn(200);setTimeout(function(){if(e.isFunction(n.complete)){n.complete.call(this)}},200)},250)}}})}return false})}})(jQuery)
